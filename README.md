# FrameModelMaker-Web

**Ver. 1.0.1**

立体フレーム（骨組構造）の解析モデルを作成・編集・可視化するための Web アプリケーションです。
ブラウザ上で動作し、インストール不要で構造解析用のモデルデータを扱えます。

> C# Windows Forms アプリケーション「Ebi-FrameTerminal」の Web 版として再実装しました。

## 主な機能

- **3D モデルビューア** — Three.js による立体フレームモデルのリアルタイム 3D 表示。回転・パン・ズームに対応
- **3D 要素選択** — 3D ビューで節点・部材をクリックして選択。選択要素の情報をフローティングパネルに表示
- **データ編集** — 節点・部材・断面・材料・境界条件・バネ・壁・荷重をタブ切替式のグリッドで直接編集
- **ファイル入出力** — シンプルな JSON 形式で保存・読込
- **モデル操作** — 節点ソート、番号再割当、重複ノード統合
- **荷重定義管理** — 複数の荷重ケースの追加・削除・切替
- **多言語対応（i18n）** — 日本語 / 英語の UI 切替。メニュー・タブ・グリッド列ヘッダー・ステータスメッセージ・ヘルプを含む全 UI テキストに対応
- **ダーク / ライトモード** — ワンクリックでテーマを切替。3D ビューアの背景・グリッド・ラベル色も連動
- **ヘルプダイアログ** — アプリの操作方法を確認できるビルトインマニュアル。多言語対応

## 技術スタック

| 項目 | 技術 |
|------|------|
| 言語 | TypeScript |
| 3D 描画 | [Three.js](https://threejs.org/) v0.182 |
| ビルド | [Vite](https://vite.dev/) v7.3 |
| テスト | [Vitest](https://vitest.dev/) v3.0 |
| CI | GitHub Actions（Node.js 20 / 22） |
| デプロイ | GitHub Pages（静的ホスティング） |

## セットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev

# プロダクションビルド（dist/ に出力）
npm run build

# ビルド結果のプレビュー
npm run preview
```

## 使い方

### ファイル操作

| 操作 | 説明 |
|------|------|
| 新規作成 | 空のモデルを作成 |
| 開く | `.json` ファイルを読み込み |
| 保存 | 現在のモデルを `.json` ファイルとしてダウンロード |
| サンプル読込 | 内蔵のサンプルデータ（3 階建て建物モデル）を読み込み |

### 3D ビュー操作

| マウス操作 | 動作 |
|------------|------|
| 左クリック | 節点・部材を選択し、情報パネルを表示（空白クリックで解除） |
| 左ドラッグ | 回転 |
| 右ドラッグ | 平行移動 |
| ホイール | ズーム |

### 選択情報パネル

3D ビュー内で節点または部材をクリックすると、右上に選択要素の情報パネルが表示されます。`×` ボタンまたは 3D ビューの空白クリックで閉じられます。

### データ編集

画面右側のデータパネルで、タブを切り替えてモデルの各要素を編集できます。

**編集可能なデータ**: 節点、境界条件、材料、断面、バネ、部材、壁、節点荷重、CMQ 荷重、部材荷重

### 言語・テーマ切替

メニューバー右端のボタンで操作できます。設定はブラウザに保存され、次回アクセス時にも維持されます。

| ボタン | 機能 |
|--------|------|
| **ダーク** / **Light** | ダークモード ↔ ライトモードの切替 |
| **EN** / **JA** | 日本語 ↔ 英語の切替 |
| **?** | ヘルプダイアログの表示 |

## 単位系・座標系

| 種別 | 単位 |
|------|------|
| 長さ | cm |
| 力 | kN |
| モーメント | kN\*cm |
| 応力 | kN/cm² |

座標系は **X**（水平・右方向）、**Y**（水平・奥行方向）、**Z**（鉛直・上方向）です。

## プロジェクト構成

```
src/
├── main.ts              # アプリケーションのエントリポイント
├── i18n.ts              # 多言語対応（日本語/英語 翻訳辞書）
├── models/              # データモデル（Node, Member, Section 等）
│   └── FrameDocument.ts # ドキュメント統括クラス
├── io/                  # ファイル入出力
│   └── FrameJson.ts     # .json 読み書き
├── viewer/
│   └── ModelViewer.ts   # Three.js 3D ビューア
├── ui/
│   └── DataGrid.ts      # 汎用データグリッドコンポーネント
├── data/
│   └── gridColumns.json # 列定義（keyベース）
└── styles/
    └── main.css         # CSS 変数によるテーマ定義

tests/                   # Vitest テストスイート
├── models/              # モデル単体テスト
└── io/                  # JSON 入出力テスト

public/
└── favicon.svg          # アプリアイコン（SVG）
```

## JSON 入力フォーマット

保存・編集の基本フォーマットは、クラスプロパティをそのまま並べたシンプルな JSON です（説明ヘッダーなし）。

```json
{
  "title": "Sample",
  "loadCaseCount": 1,
  "loadCaseIndex": 0,
  "nodes": [{ "number": 1, "x": 0, "y": 0, "z": 0, "loads": [] }],
  "members": [],
  "sections": [],
  "materials": [],
  "boundaries": [],
  "springs": [],
  "walls": [],
  "calcCaseMemo": []
}
```

## 開発

### 前提条件

- Node.js 20 以上
- npm

### ビルドと検証

```bash
# TypeScript の型チェック
npm run typecheck

# テストの実行
npm test

# 開発サーバー（ホットリロード対応）
npm run dev

# プロダクションビルド
npm run build
```

### CI

GitHub Actions により、プッシュおよびプルリクエスト時に以下が自動実行されます。

- TypeScript 型チェック
- Vitest テスト（65 テストケース）
- プロダクションビルド

## 更新履歴

### Ver. 1.0.1（2026-02-17）

- 入力・保存フォーマットを JSON に統一
- StructForm（`.dat`）関連コードとサンプルを削除
- 列定義を `gridColumns.json` に集約し、ヘッダーを簡素化
- オリジナルモデルデータを JSON へ変換したサンプルを同梱
- README とビルトインヘルプ（簡易マニュアル）を現仕様に更新

### Ver. 1.0.0（2026-02-17）

初回リリース。

- 3D モデルビューア（Three.js）による立体フレームモデルの表示
- JSON 形式の読み込み・書き出し
- タブ切替式データグリッドによるモデル要素の編集
- 節点ソート・番号再割当・重複ノード統合
- 複数荷重ケースの管理
- 多言語対応（日本語 / 英語）
- ダークモード / ライトモード切替
- ビルトインヘルプダイアログ
- SVG ファビコン
- GitHub Actions CI（型チェック・テスト・ビルド）
- Vitest によるテストスイート（65 テストケース）

## ライセンス

このプロジェクトのライセンスについては、リポジトリのライセンスファイルを参照してください。

### サードパーティライセンス

本アプリケーションは以下のオープンソースライブラリを使用しています。

| ライブラリ | ライセンス | 用途 |
|-----------|-----------|------|
| [Three.js](https://threejs.org/) | MIT | 3D モデル描画 |

ライセンス全文は [`THIRD_PARTY_NOTICES.md`](THIRD_PARTY_NOTICES.md) を参照してください。
